var data = {lines:[
{"lineNum":"    1","line":"/* $OpenBSD: tls_server.c,v 1.17 2015/09/12 19:54:31 jsing Exp $ */"},
{"lineNum":"    2","line":"/*"},
{"lineNum":"    3","line":" * Copyright (c) 2014 Joel Sing <jsing@openbsd.org>"},
{"lineNum":"    4","line":" *"},
{"lineNum":"    5","line":" * Permission to use, copy, modify, and distribute this software for any"},
{"lineNum":"    6","line":" * purpose with or without fee is hereby granted, provided that the above"},
{"lineNum":"    7","line":" * copyright notice and this permission notice appear in all copies."},
{"lineNum":"    8","line":" *"},
{"lineNum":"    9","line":" * THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES"},
{"lineNum":"   10","line":" * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF"},
{"lineNum":"   11","line":" * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR"},
{"lineNum":"   12","line":" * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES"},
{"lineNum":"   13","line":" * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN"},
{"lineNum":"   14","line":" * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF"},
{"lineNum":"   15","line":" * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE."},
{"lineNum":"   16","line":" */"},
{"lineNum":"   17","line":""},
{"lineNum":"   18","line":"#include <openssl/ec.h>"},
{"lineNum":"   19","line":"#include <openssl/err.h>"},
{"lineNum":"   20","line":"#include <openssl/ssl.h>"},
{"lineNum":"   21","line":""},
{"lineNum":"   22","line":"#include <tls.h>"},
{"lineNum":"   23","line":"#include \"tls_internal.h\""},
{"lineNum":"   24","line":""},
{"lineNum":"   25","line":"struct tls *"},
{"lineNum":"   26","line":"tls_server(void)"},
{"lineNum":"   27","line":"{","class":"lineCov","hits":"1","order":"351","possible_hits":"1",},
{"lineNum":"   28","line":"\tstruct tls *ctx;"},
{"lineNum":"   29","line":""},
{"lineNum":"   30","line":"\tif ((ctx = tls_new()) == NULL)","class":"lineCov","hits":"1","order":"352","possible_hits":"1",},
{"lineNum":"   31","line":"\t\treturn (NULL);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   32","line":""},
{"lineNum":"   33","line":"\tctx->flags |= TLS_SERVER;","class":"lineCov","hits":"1","order":"380","possible_hits":"1",},
{"lineNum":"   34","line":""},
{"lineNum":"   35","line":"\treturn (ctx);","class":"lineCov","hits":"1","order":"381","possible_hits":"1",},
{"lineNum":"   36","line":"}","class":"lineCov","hits":"1","order":"382","possible_hits":"1",},
{"lineNum":"   37","line":""},
{"lineNum":"   38","line":"struct tls *"},
{"lineNum":"   39","line":"tls_server_conn(struct tls *ctx)"},
{"lineNum":"   40","line":"{","class":"lineCov","hits":"1","order":"576","possible_hits":"1",},
{"lineNum":"   41","line":"\tstruct tls *conn_ctx;"},
{"lineNum":"   42","line":""},
{"lineNum":"   43","line":"\tif ((conn_ctx = tls_new()) == NULL)","class":"lineCov","hits":"1","order":"577","possible_hits":"1",},
{"lineNum":"   44","line":"\t\treturn (NULL);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   45","line":""},
{"lineNum":"   46","line":"\tconn_ctx->flags |= TLS_SERVER_CONN;","class":"lineCov","hits":"1","order":"578","possible_hits":"1",},
{"lineNum":"   47","line":""},
{"lineNum":"   48","line":"\treturn (conn_ctx);","class":"lineCov","hits":"1","order":"579","possible_hits":"1",},
{"lineNum":"   49","line":"}","class":"lineCov","hits":"1","order":"580","possible_hits":"1",},
{"lineNum":"   50","line":""},
{"lineNum":"   51","line":"int"},
{"lineNum":"   52","line":"tls_configure_server(struct tls *ctx)"},
{"lineNum":"   53","line":"{","class":"lineCov","hits":"2","order":"397","possible_hits":"2",},
{"lineNum":"   54","line":"\tEC_KEY *ecdh_key;"},
{"lineNum":"   55","line":"\tunsigned char sid[SSL_MAX_SSL_SESSION_ID_LENGTH];"},
{"lineNum":"   56","line":""},
{"lineNum":"   57","line":"\tif ((ctx->ssl_ctx = SSL_CTX_new(SSLv23_server_method())) == NULL) {","class":"lineCov","hits":"1","order":"398","possible_hits":"1",},
{"lineNum":"   58","line":"\t\ttls_set_errorx(ctx, \"ssl context failure\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   59","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   60","line":"\t}"},
{"lineNum":"   61","line":""},
{"lineNum":"   62","line":"\tif (tls_configure_ssl(ctx) != 0)","class":"lineCov","hits":"1","order":"399","possible_hits":"1",},
{"lineNum":"   63","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   64","line":"\tif (tls_configure_keypair(ctx, 1) != 0)","class":"lineCov","hits":"1","order":"419","possible_hits":"1",},
{"lineNum":"   65","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   66","line":"\tif (ctx->config->verify_client != 0) {","class":"lineCov","hits":"1","order":"436","possible_hits":"1",},
{"lineNum":"   67","line":"\t\tint verify = SSL_VERIFY_PEER;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   68","line":"\t\tif (ctx->config->verify_client == 1)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   69","line":"\t\t\tverify |= SSL_VERIFY_FAIL_IF_NO_PEER_CERT;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   70","line":"\t\tif (tls_configure_ssl_verify(ctx, verify) == -1)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   71","line":"\t\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   72","line":"\t}"},
{"lineNum":"   73","line":""},
{"lineNum":"   74","line":"\tif (ctx->config->dheparams == -1)","class":"lineCov","hits":"1","order":"437","possible_hits":"1",},
{"lineNum":"   75","line":"\t\tSSL_CTX_set_dh_auto(ctx->ssl_ctx, 1);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   76","line":"\telse if (ctx->config->dheparams == 1024)","class":"lineCov","hits":"1","order":"438","possible_hits":"1",},
{"lineNum":"   77","line":"\t\tSSL_CTX_set_dh_auto(ctx->ssl_ctx, 2);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   78","line":""},
{"lineNum":"   79","line":"\tif (ctx->config->ecdhecurve == -1) {","class":"lineCov","hits":"1","order":"439","possible_hits":"1",},
{"lineNum":"   80","line":"\t\tSSL_CTX_set_ecdh_auto(ctx->ssl_ctx, 1);","class":"lineCov","hits":"1","order":"440","possible_hits":"1",},
{"lineNum":"   81","line":"\t} else if (ctx->config->ecdhecurve != NID_undef) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   82","line":"\t\tif ((ecdh_key = EC_KEY_new_by_curve_name(","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   83","line":"\t\t    ctx->config->ecdhecurve)) == NULL) {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   84","line":"\t\t\ttls_set_errorx(ctx, \"failed to set ECDHE curve\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   85","line":"\t\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   86","line":"\t\t}"},
{"lineNum":"   87","line":"\t\tSSL_CTX_set_options(ctx->ssl_ctx, SSL_OP_SINGLE_ECDH_USE);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   88","line":"\t\tSSL_CTX_set_tmp_ecdh(ctx->ssl_ctx, ecdh_key);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   89","line":"\t\tEC_KEY_free(ecdh_key);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"   90","line":"\t}"},
{"lineNum":"   91","line":""},
{"lineNum":"   92","line":"\tif (ctx->config->ciphers_server == 1)","class":"lineCov","hits":"1","order":"441","possible_hits":"1",},
{"lineNum":"   93","line":"\t\tSSL_CTX_set_options(ctx->ssl_ctx,","class":"lineCov","hits":"1","order":"442","possible_hits":"1",},
{"lineNum":"   94","line":"\t\t    SSL_OP_CIPHER_SERVER_PREFERENCE);"},
{"lineNum":"   95","line":""},
{"lineNum":"   96","line":"\t/*"},
{"lineNum":"   97","line":"\t * Set session ID context to a random value.  We don\'t support"},
{"lineNum":"   98","line":"\t * persistent caching of sessions so it is OK to set a temporary"},
{"lineNum":"   99","line":"\t * session ID context that is valid during run time."},
{"lineNum":"  100","line":"\t */"},
{"lineNum":"  101","line":"\tarc4random_buf(sid, sizeof(sid));","class":"lineCov","hits":"1","order":"443","possible_hits":"1",},
{"lineNum":"  102","line":"\tif (!SSL_CTX_set_session_id_context(ctx->ssl_ctx, sid, sizeof(sid))) {","class":"lineCov","hits":"1","order":"444","possible_hits":"1",},
{"lineNum":"  103","line":"\t\ttls_set_errorx(ctx, \"failed to set session id context\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  104","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  105","line":"\t}"},
{"lineNum":"  106","line":""},
{"lineNum":"  107","line":"\treturn (0);","class":"lineCov","hits":"1","order":"445","possible_hits":"1",},
{"lineNum":"  108","line":""},
{"lineNum":"  109","line":" err:"},
{"lineNum":"  110","line":"\treturn (-1);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  111","line":"}","class":"lineCov","hits":"1","order":"446","possible_hits":"1",},
{"lineNum":"  112","line":""},
{"lineNum":"  113","line":"int"},
{"lineNum":"  114","line":"tls_accept_socket(struct tls *ctx, struct tls **cctx, int socket)"},
{"lineNum":"  115","line":"{","class":"lineCov","hits":"1","order":"570","possible_hits":"1",},
{"lineNum":"  116","line":"\treturn (tls_accept_fds(ctx, cctx, socket, socket));","class":"lineCov","hits":"1","order":"571","possible_hits":"1",},
{"lineNum":"  117","line":"}","class":"lineCov","hits":"1","order":"588","possible_hits":"1",},
{"lineNum":"  118","line":""},
{"lineNum":"  119","line":"int"},
{"lineNum":"  120","line":"tls_accept_fds(struct tls *ctx, struct tls **cctx, int fd_read, int fd_write)"},
{"lineNum":"  121","line":"{","class":"lineCov","hits":"1","order":"572","possible_hits":"1",},
{"lineNum":"  122","line":"\tstruct tls *conn_ctx = NULL;","class":"lineCov","hits":"1","order":"573","possible_hits":"1",},
{"lineNum":"  123","line":""},
{"lineNum":"  124","line":"\tif ((ctx->flags & TLS_SERVER) == 0) {","class":"lineCov","hits":"1","order":"574","possible_hits":"1",},
{"lineNum":"  125","line":"\t\ttls_set_errorx(ctx, \"not a server context\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  126","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  127","line":"\t}"},
{"lineNum":"  128","line":""},
{"lineNum":"  129","line":"\tif ((conn_ctx = tls_server_conn(ctx)) == NULL) {","class":"lineCov","hits":"1","order":"575","possible_hits":"1",},
{"lineNum":"  130","line":"\t\ttls_set_errorx(ctx, \"connection context failure\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  131","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  132","line":"\t}"},
{"lineNum":"  133","line":""},
{"lineNum":"  134","line":"\tif ((conn_ctx->ssl_conn = SSL_new(ctx->ssl_ctx)) == NULL) {","class":"lineCov","hits":"1","order":"581","possible_hits":"1",},
{"lineNum":"  135","line":"\t\ttls_set_errorx(ctx, \"ssl failure\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  136","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  137","line":"\t}"},
{"lineNum":"  138","line":"\tif (SSL_set_app_data(conn_ctx->ssl_conn, conn_ctx) != 1) {","class":"lineCov","hits":"1","order":"582","possible_hits":"1",},
{"lineNum":"  139","line":"\t\ttls_set_errorx(ctx, \"ssl application data failure\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  140","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  141","line":"\t}"},
{"lineNum":"  142","line":"\tif (SSL_set_rfd(conn_ctx->ssl_conn, fd_read) != 1 ||","class":"lineCov","hits":"2","order":"583","possible_hits":"2",},
{"lineNum":"  143","line":"\t    SSL_set_wfd(conn_ctx->ssl_conn, fd_write) != 1) {","class":"lineCov","hits":"1","order":"584","possible_hits":"1",},
{"lineNum":"  144","line":"\t\ttls_set_errorx(ctx, \"ssl file descriptor failure\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  145","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  146","line":"\t}"},
{"lineNum":"  147","line":""},
{"lineNum":"  148","line":"\t*cctx = conn_ctx;","class":"lineCov","hits":"1","order":"585","possible_hits":"1",},
{"lineNum":"  149","line":""},
{"lineNum":"  150","line":"\treturn (0);","class":"lineCov","hits":"1","order":"586","possible_hits":"1",},
{"lineNum":"  151","line":""},
{"lineNum":"  152","line":" err:"},
{"lineNum":"  153","line":"\ttls_free(conn_ctx);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  154","line":""},
{"lineNum":"  155","line":"\t*cctx = NULL;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  156","line":""},
{"lineNum":"  157","line":"\treturn (-1);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  158","line":"}","class":"lineCov","hits":"1","order":"587","possible_hits":"1",},
{"lineNum":"  159","line":""},
{"lineNum":"  160","line":"int"},
{"lineNum":"  161","line":"tls_handshake_server(struct tls *ctx)"},
{"lineNum":"  162","line":"{","class":"lineCov","hits":"1","order":"619","possible_hits":"1",},
{"lineNum":"  163","line":"\tint ssl_ret;"},
{"lineNum":"  164","line":"\tint rv = -1;","class":"lineCov","hits":"1","order":"620","possible_hits":"1",},
{"lineNum":"  165","line":""},
{"lineNum":"  166","line":"\tif ((ctx->flags & TLS_SERVER_CONN) == 0) {","class":"lineCov","hits":"1","order":"621","possible_hits":"1",},
{"lineNum":"  167","line":"\t\ttls_set_errorx(ctx, \"not a server connection context\");","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  168","line":"\t\tgoto err;","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  169","line":"\t}"},
{"lineNum":"  170","line":""},
{"lineNum":"  171","line":"\tERR_clear_error();","class":"lineCov","hits":"1","order":"622","possible_hits":"1",},
{"lineNum":"  172","line":"\tif ((ssl_ret = SSL_accept(ctx->ssl_conn)) != 1) {","class":"lineCov","hits":"1","order":"623","possible_hits":"1",},
{"lineNum":"  173","line":"\t\trv = tls_ssl_error(ctx, ctx->ssl_conn, ssl_ret, \"handshake\");","class":"lineCov","hits":"1","order":"1014","possible_hits":"1",},
{"lineNum":"  174","line":"\t\tgoto err;","class":"lineCov","hits":"1","order":"1024","possible_hits":"1",},
{"lineNum":"  175","line":"\t}"},
{"lineNum":"  176","line":""},
{"lineNum":"  177","line":"\tctx->state |= TLS_HANDSHAKE_COMPLETE;","class":"lineCov","hits":"1","order":"742","possible_hits":"1",},
{"lineNum":"  178","line":"\trv = 0;","class":"lineCov","hits":"1","order":"744","possible_hits":"1",},
{"lineNum":"  179","line":""},
{"lineNum":"  180","line":" err:"},
{"lineNum":"  181","line":"\treturn (rv);","class":"lineCov","hits":"1","order":"745","possible_hits":"1",},
{"lineNum":"  182","line":"}","class":"linePartCov","hits":"1","order":"746","possible_hits":"2",},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "test_server-233d18b05fb5cd7c", "date" : "2016-02-11 00:49:01", "instrumented" : 89, "covered" : 50,};
var merged_data = [];
